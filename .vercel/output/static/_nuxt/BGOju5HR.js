const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CY8Q5OdD.js","./C50InBbU.js"])))=>i.map(i=>d[i]);
import{y as u,z as s,x as l,s as c}from"./C50InBbU.js";const h=u(async(o,n)=>{let e,i;if(console.log("🛡️ Middleware auth - Route:",o.path,"depuis:",n==null?void 0:n.path),o.path==="/login"&&(n==null?void 0:n.path)==="/login"){console.log("🔄 Évitement boucle de redirection login");return}if(o.path.startsWith("/dashboard")){console.log("🔍 Accès dashboard - Vérification stricte...");try{const{useAuthStore:r}=([e,i]=s(()=>l(()=>import("./CY8Q5OdD.js"),__vite__mapDeps([0,1]),import.meta.url)),e=await e,i(),e),t=r();if(!t.isInitialized&&(console.log("⚡ Initialisation auth en cours..."),!([e,i]=s(()=>t.initAuth()),e=await e,i(),e)))return console.log("❌ Échec authentification - Redirection login"),c("/login?redirect="+encodeURIComponent(o.fullPath));if(!t.isLoggedIn||t.isSessionExpired){console.log("❌ Non authentifié ou session expirée - Redirection login");try{[e,i]=s(()=>t.clearAuthData()),await e,i()}catch(a){console.warn("⚠️ Erreur nettoyage données auth:",a)}return c("/login?redirect="+encodeURIComponent(o.fullPath))}console.log("✅ Authentification validée - Accès dashboard autorisé")}catch(r){return console.error("❌ Erreur critique middleware:",r),c("/login?error=auth_error")}}if(o.path==="/login")try{const{useAuthStore:r}=([e,i]=s(()=>l(()=>import("./CY8Q5OdD.js"),__vite__mapDeps([0,1]),import.meta.url)),e=await e,i(),e),t=r();if(t.isInitialized&&t.isLoggedIn&&!t.isSessionExpired){console.log("🔄 Déjà connecté - Redirection vers dashboard");const a=o.query.redirect||"/dashboard";return c(a)}}catch(r){console.error("❌ Erreur vérification login:",r)}});export{h as default};
