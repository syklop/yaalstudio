const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CY8Q5OdD.js","./C50InBbU.js"])))=>i.map(i=>d[i]);
import{y as u,z as s,x as l,s as c}from"./C50InBbU.js";const h=u(async(o,n)=>{let e,i;if(console.log("ğŸ›¡ï¸ Middleware auth - Route:",o.path,"depuis:",n==null?void 0:n.path),o.path==="/login"&&(n==null?void 0:n.path)==="/login"){console.log("ğŸ”„ Ã‰vitement boucle de redirection login");return}if(o.path.startsWith("/dashboard")){console.log("ğŸ” AccÃ¨s dashboard - VÃ©rification stricte...");try{const{useAuthStore:r}=([e,i]=s(()=>l(()=>import("./CY8Q5OdD.js"),__vite__mapDeps([0,1]),import.meta.url)),e=await e,i(),e),t=r();if(!t.isInitialized&&(console.log("âš¡ Initialisation auth en cours..."),!([e,i]=s(()=>t.initAuth()),e=await e,i(),e)))return console.log("âŒ Ã‰chec authentification - Redirection login"),c("/login?redirect="+encodeURIComponent(o.fullPath));if(!t.isLoggedIn||t.isSessionExpired){console.log("âŒ Non authentifiÃ© ou session expirÃ©e - Redirection login");try{[e,i]=s(()=>t.clearAuthData()),await e,i()}catch(a){console.warn("âš ï¸ Erreur nettoyage donnÃ©es auth:",a)}return c("/login?redirect="+encodeURIComponent(o.fullPath))}console.log("âœ… Authentification validÃ©e - AccÃ¨s dashboard autorisÃ©")}catch(r){return console.error("âŒ Erreur critique middleware:",r),c("/login?error=auth_error")}}if(o.path==="/login")try{const{useAuthStore:r}=([e,i]=s(()=>l(()=>import("./CY8Q5OdD.js"),__vite__mapDeps([0,1]),import.meta.url)),e=await e,i(),e),t=r();if(t.isInitialized&&t.isLoggedIn&&!t.isSessionExpired){console.log("ğŸ”„ DÃ©jÃ  connectÃ© - Redirection vers dashboard");const a=o.query.redirect||"/dashboard";return c(a)}}catch(r){console.error("âŒ Erreur vÃ©rification login:",r)}});export{h as default};
